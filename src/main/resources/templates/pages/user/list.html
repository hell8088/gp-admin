<!DOCTYPE html>
<html lang="zh" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/main.html}">
<body layout:fragment="content">
	<div class="layui-tab layui-tab-brief">
		<ul class="layui-tab-title">
			<li class="layui-this"><a href="#">用户管理</a></li>
		</ul>
	</div>
	<div class="layui-form layui-tab-content" id="LAY_ucm"
		style="padding: 5px 0;">
		<div class="layui-tab-item layui-show">
			<div class="layui-main">
				<!-- 主框架内 -->

				<table class="layui-hide" id="test" lay-filter="test"></table>

				<!-- /主框架内 -->
			</div>
		</div>
	</div>

	<script type="text/html" id="toolbarDemo">
  		<div class="layui-btn-container">
    		<button class="layui-btn layui-btn-sm" lay-event="add">新增用户</button>
  		</div>
	</script>
 
	<script type="text/html" id="barDemo">
  		<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  		<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
	</script>
	
	<script type="text/html" id="checkboxTpl">
  		<input type="checkbox" name="lock" value="{{d.id}}" lay-skin="switch" lay-text="开启|停用" lay-filter="userLock" {{ d.locked ? 'checked' : '' }}>
	</script>
              
	<script>
	layui.use('table', function(){
	  var table = layui.table,form = layui.form;
	  
	  table.render({
	    elem: '#test'
	    ,url: '/api/user/data'   //'/assets/demodata/table1.json'
	    ,toolbar: '#toolbarDemo'
	    ,title: '用户数据表'
	    ,cols: [
	    	[
		      //{type: 'checkbox', fixed: 'left'}
		        {field:'id', title:'id'},
		    	{field:'username', title:'用户名'},
		    	{field:'roleIds', title:'角色列表'},
		    	{field:'locked', title:'状态'},
		    	{field:'locked', title:'是否锁定', templet: '#checkboxTpl', unresize: true , width:120},
		    	{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}
	    	]
	    ]
	    ,page: true
	    ,limits: [5, 10, 15] //显示
        ,limit: 10 //每页默认显示的数量
	  });
	  
	  //头工具栏事件
	  table.on('toolbar(test)', function(obj){
		var checkStatus = table.checkStatus(obj.config.id);
		switch(obj.event){
		  case 'add':
			  window.open(BASE_URL + "user/edit?id=0","_self");
		  break;
		};
	  });
	  
	  //监听行工具事件
	  table.on('tool(test)', function(obj){
		var data = obj.data;
		//console.log(obj)
		if(obj.event === 'del'){
		  layer.confirm('真的删除行么', function(index){
			  delUser(data.id);
		  });
		} else if(obj.event === 'edit'){
			window.open(BASE_URL + "user/edit?id="+data.id,"_self");
		}
	  });
	  
	  //监听
	  form.on('switch(userLock)', function(obj){
	  	var id = this.value;
	  	var lockStatus = obj.elem.checked;
	  	alert(lockStatus);
		params = {
			id : id,
			lockStatus : lockStatus
		};
		$.ajax({
			type : "post",
			data : params,
			url : "/api/user/lock",
			success : function(resObj) {
				window.open(BASE_URL + "user/list","_self");
			}
		});
	    //layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
	  });
	});
	
	function delUser(id){
		params = {
			id : id,
		};
		$.ajax({
			type : "post",
			data : params,
			url : "/api/user/del",
			success : function(resObj) {
				window.open(BASE_URL + "user/list","_self");
			}
		});
	}
	</script>

</body>
</html>